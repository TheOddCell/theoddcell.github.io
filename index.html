<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>(the)OddCell.ca</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <a href="/"><h1>TheOddCell</h1></a>
  <nav>
    <a href="/aboutme">About Me</a>
    <span class="separator">|</span>
    <a href="/keys">GPG Keys</a>
    <span class="separator">|</span>
    <a href="/obsidianos">ObsidianOS</a>
  </nav>

  <div class="projects" id="projects"></div>

  <script>
    const CACHE_KEY = 'github_repos_cache';
    const CACHE_TIME = 30 * 60 * 1000; // 30 minutes
    const GITHUB_USER = 'TheOddCell';

    async function fetchRepos() {
      const cached = localStorage.getItem(CACHE_KEY);
      const cacheTime = localStorage.getItem(CACHE_KEY + '_time');

      if (cached && cacheTime && Date.now() - cacheTime < CACHE_TIME) {
        return JSON.parse(cached);
      }

      const res = await fetch(`https://api.github.com/users/${GITHUB_USER}/repos?per_page=100`);
      let repos = await res.json();

      // Remove forks
      repos = repos.filter(repo => !repo.fork);

      // Sort by most recent commit
      repos.sort((a, b) => new Date(b.pushed_at) - new Date(a.pushed_at));

      localStorage.setItem(CACHE_KEY, JSON.stringify(repos));
      localStorage.setItem(CACHE_KEY + '_time', Date.now());
      return repos;
    }

    async function renderProjects() {
      const container = document.getElementById('projects');
      const repos = await fetchRepos();

      for (const repo of repos) {
        const card = document.createElement('div');
        card.className = 'project';

        const title = document.createElement('h2');
        title.textContent = repo.name;

        const desc = document.createElement('p');
        desc.textContent = repo.description || 'No description available.';

        const link = document.createElement('a');
        link.href = repo.html_url;
        link.target = '_blank';
        link.appendChild(title);
        card.appendChild(link);
        card.appendChild(desc);

        container.appendChild(card);
      }
    }

    renderProjects();
  </script>
</body>
</html>
